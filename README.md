# Yandex Market Bot

Этот проект представляет собой Telegram-бота, который автоматически загружает файл Excel, сравнивает его с предыдущей версией, обновляет XML файл и логирует все изменения. Проект упакован в Docker-контейнер для удобства развертывания и использования.

## Структура проекта

- **main.py**: Основной скрипт, который запускает Telegram-бота, скачивает файл Excel и запускает процесс сравнения и обновления.
- **excel_main.py**: Скрипт, который сравнивает новый и старый файлы Excel, генерирует сводку изменений и обновляет XML файл.
- **xml_converter.py**: Скрипт, который генерирует XML файл из данных Excel и выполняет поиск изображений для продуктов.
- **start.sh**: Скрипт для запуска проекта в screen сессии, чтобы он продолжал работать в фоне.
- **Dockerfile**: Dockerfile для создания контейнера, в котором будет выполняться проект.

## Установка и запуск

### Требования

- Docker
- Docker Compose (опционально)

### Сборка контейнера

1. Клонируйте репозиторий:
    ```bash
    git clone https://github.com/yourusername/yourrepository.git
    cd yourrepository
    ```

2. Постройте Docker-образ:
    ```bash
    docker build -t yandex_market_bot .
    ```

### Запуск контейнера

1. Запустите контейнер:
    ```bash
    docker run -d --name yandex_market_bot_container yandex_market_bot
    ```

2. Чтобы убедиться, что контейнер запущен:
    ```bash
    docker ps
    ```

### Просмотр логов

1. Для просмотра логов внутри контейнера:
    ```bash
    docker logs yandex_market_bot_container
    ```

2. Для просмотра логов в реальном времени:
    ```bash
    docker logs -f yandex_market_bot_container
    ```

### Остановка и удаление контейнера

1. Чтобы остановить контейнер:
    ```bash
    docker stop yandex_market_bot_container
    ```

2. Чтобы удалить контейнер:
    ```bash
    docker rm yandex_market_bot_container
    ```

## Описание файлов

### main.py

- Создает Telegram клиента.
- Слушает новые сообщения от бота.
- Скачивает файл Excel.
- Переименовывает старый файл и запускает `excel_main.py` для обработки нового файла.

### excel_main.py

- Сравнивает новый и старый файлы Excel.
- Генерирует сводку изменений (добавленные, удаленные и обновленные строки).
- Обновляет XML файл на основе сводки изменений.

### xml_converter.py

- Читает данные из файла Excel.
- Генерирует XML файл.
- Выполняет поиск изображений для продуктов через Bing.
- Интерагирует с OpenAI для получения дополнительных данных о продуктах.

### start.sh

- Создает файл логов.
- Запускает скрипт `main.py` в screen сессии.
- Показывает логи в реальном времени.

### Dockerfile

- Использует официальный образ Ubuntu.
- Устанавливает все необходимые зависимости (Python, curl, screen и т.д.).
- Создает виртуальное окружение Python и устанавливает зависимости проекта.
- Копирует файлы проекта в контейнер.
- Запускает скрипт `start.sh`.

## Переменные окружения

- `API_ID`: ID вашего Telegram API.
- `API_HASH`: Hash вашего Telegram API.
- `PHONE_NUMBER`: Номер телефона вашего Telegram аккаунта.
- `BOT_USERNAME`: Имя пользователя вашего бота.
- `CHAT_GPT_API_KEY`: API ключ OpenAI.
- `ASSISTANT_ID`: ID вашего ассистента OpenAI.
- `DELAY_TIME`: Время задержки между запросами в секундах (по умолчанию 60 секунд).
- `IMAGE_COUNT`: Количество изображений для поиска (по умолчанию 15).
- `OPENAI_PROXY_URL`: URL прокси для OpenAI (если требуется).

## Дополнительная информация

- **Логи**: Все логи записываются в файл `/var/log/screen.log` внутри контейнера.
- **Проверка статуса**: Можно использовать команды Docker для проверки состояния контейнера и его логов.

Этот проект автоматизирует процесс обновления данных продуктов и генерации XML файла для Yandex Market, делая его удобным и простым в использовании благодаря Docker-контейнеризации.
